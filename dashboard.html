<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>USASpending Code Intelligence Dashboard - Enhanced</title>
    
    <!-- USWDS CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@uswds/uswds@3.8.2/dist/css/uswds.min.css">
    
    <!-- USWDS JavaScript Initializer -->
    <script src="https://cdn.jsdelivr.net/npm/@uswds/uswds@3.8.2/dist/js/uswds-init.min.js"></script>
    
    <!-- External dependencies for enhanced features -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    
    <!-- Dashboard CSS -->
    <link rel="stylesheet" href="/assets/dashboard.css">
    
    <!-- Enhanced Dashboard Styles -->
    <style>
        .enhanced-feature-badge {
            background: linear-gradient(45deg, #0066cc, #00a6d6);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: 600;
            margin-left: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .interactive-button {
            position: relative;
            overflow: hidden;
        }
        
        .interactive-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .interactive-button:hover::before {
            left: 100%;
        }
        
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .feature-card {
            background: var(--dashboard-bg-card);
            border: 1px solid var(--dashboard-border-light);
            border-radius: 8px;
            padding: 20px;
            transition: all 0.3s ease;
        }
        
        .feature-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .complexity-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .complexity-low { background-color: #28a745; }
        .complexity-medium { background-color: #ffc107; }
        .complexity-high { background-color: #fd7e14; }
        .complexity-very-high { background-color: #dc3545; }
        
        .d3-visualization {
            min-height: 400px;
            border: 1px solid var(--dashboard-border-light);
            border-radius: 6px;
            background: var(--dashboard-bg-card);
        }
        
        .enhanced-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: var(--dashboard-bg-secondary);
            padding: 15px;
            border-radius: 6px;
            text-align: center;
            border-left: 4px solid var(--dashboard-accent-primary);
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: var(--dashboard-accent-primary);
        }
        
        .stat-label {
            font-size: 0.9em;
            color: var(--dashboard-text-secondary);
            margin-top: 5px;
        }
    </style>
</head>
<body class="usa-body">
    <!-- Enhanced Header with Feature Indicators -->
    <header class="usa-header usa-header--basic" role="banner">
        <div class="usa-nav-container">
            <div class="usa-navbar">
                <div class="usa-logo" id="basic-logo">
                    <em class="usa-logo__text">
                        <a href="/" title="Home" aria-label="Home">
                            🎯 USASpending Code Intelligence
                            <span class="enhanced-feature-badge">Enhanced</span>
                        </a>
                    </em>
                </div>
            </div>
        </div>
    </header>

    <div class="usa-layout-docs dashboard-flex-layout">
        <!-- Enhanced Sidebar Navigation -->
        <aside class="usa-layout-docs__sidenav collapsible-sidenav" id="sidebarNav" aria-label="Dashboard navigation">
            <button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle navigation" aria-expanded="true" aria-controls="sidebarNav">
                <span class="toggle-icon" aria-hidden="true">☰</span>
                <span class="toggle-label">Menu</span>
            </button>
            <nav aria-label="Secondary navigation">
                <div class="header">
                    <h1 class="usa-header__logo-text">🎯 Code Intelligence</h1>
                    <p class="usa-intro">Enhanced Analysis Dashboard</p>
                    <div style="font-size: 0.8em; color: var(--dashboard-text-muted); margin-top: 5px;">
                        ✨ D3.js Interactive Visualizations<br>
                        📊 Enhanced Complexity Analysis<br>
                        🔍 Advanced Search & Filtering
                    </div>
                </div>
                
                <!-- Enhanced Search with Keyboard Shortcut -->
                <div class="search-container" data-feature="search">
                    <div class="usa-search usa-search--small">
                        <div role="search">
                            <label class="usa-sr-only" for="search-input">Search code</label>
                            <input class="usa-input" id="search-input" type="search" name="search" placeholder="Search code (Ctrl+K)">
                            <button class="usa-button" type="submit">
                                <img src="https://cdn.jsdelivr.net/npm/@uswds/uswds@3.8.2/dist/img/usa-icons-bg/search--white.svg" class="usa-search__submit-icon" alt="Search">
                            </button>
                        </div>
                    </div>
                </div>
            
                <!-- Enhanced Navigation Menu -->
                <ul class="usa-sidenav">
                    <!-- Core Analysis -->
                    <li class="usa-sidenav__item">
                        <span class="nav-section-title">📊 Core Analysis</span>
                        <ul class="usa-sidenav__sublist">
                            <li class="usa-sidenav__item">
                                <a href="#overview" class="usa-sidenav__link usa-current" onclick="navigationManager.showSection('overview')">
                                    🏠 Enhanced Overview
                                    <span class="enhanced-feature-badge">New</span>
                                </a>
                            </li>
                            <li class="usa-sidenav__item">
                                <a href="#files" class="usa-sidenav__link" onclick="navigationManager.showSection('files')">📁 Files</a>
                            </li>
                            <li class="usa-sidenav__item">
                                <a href="#classes" class="usa-sidenav__link" onclick="navigationManager.showSection('classes')">🏗️ Classes</a>
                            </li>
                            <li class="usa-sidenav__item">
                                <a href="#functions" class="usa-sidenav__link" onclick="navigationManager.showSection('functions')">⚙️ Functions</a>
                            </li>
                            <li class="usa-sidenav__item">
                                <a href="#services" class="usa-sidenav__link" onclick="navigationManager.showSection('services')">🔧 Services</a>
                            </li>
                        </ul>
                    </li>
                    
                    <!-- Enhanced Relationships -->
                    <li class="usa-sidenav__item">
                        <span class="nav-section-title">🌐 Interactive Relationships</span>
                        <ul class="usa-sidenav__sublist">
                            <li class="usa-sidenav__item">
                                <a href="#relationships" class="usa-sidenav__link" onclick="navigationManager.showSection('relationships')">
                                    🔗 Code Relationships
                                    <span class="enhanced-feature-badge">D3</span>
                                </a>
                            </li>
                            <li class="usa-sidenav__item">
                                <a href="#dependencies" class="usa-sidenav__link" onclick="navigationManager.showSection('dependencies')">
                                    📦 Dependencies
                                    <span class="enhanced-feature-badge">Enhanced</span>
                                </a>
                            </li>
                        </ul>
                    </li>
                    
                    <!-- Enhanced Architecture -->
                    <li class="usa-sidenav__item">
                        <span class="nav-section-title">🏛️ Architecture</span>
                        <ul class="usa-sidenav__sublist">
                            <li class="usa-sidenav__item">
                                <a href="#layers" class="usa-sidenav__link" onclick="navigationManager.showSection('layers')">🏗️ Architectural Layers</a>
                            </li>
                            <li class="usa-sidenav__item">
                                <a href="#complexity" class="usa-sidenav__link" onclick="navigationManager.showSection('complexity')">
                                    🎯 Complexity Analysis
                                    <span class="enhanced-feature-badge">Pro</span>
                                </a>
                            </li>
                            <li class="usa-sidenav__item">
                                <a href="#domains" class="usa-sidenav__link" onclick="navigationManager.showSection('domains')">🏷️ Domain Analysis</a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </nav>
        </aside>
        
        <!-- Enhanced Main Content -->
        <main class="usa-layout-docs__main usa-prose" id="mainContent">
            <!-- Sidebar Toggle Script -->
            <script>
                const sidebar = document.getElementById('sidebarNav');
                const toggleBtn = document.getElementById('sidebarToggle');
                if (sidebar && toggleBtn) {
                    toggleBtn.addEventListener('click', function() {
                        const collapsed = sidebar.classList.toggle('collapsed');
                        toggleBtn.setAttribute('aria-expanded', !collapsed);
                        document.getElementById('mainContent').classList.toggle('sidebar-collapsed', collapsed);
                    });
                }
            </script>

            <!-- Enhanced Overview Section -->
            <div id="overview" class="content-section">
                <h1 class="section-title">🏠 Enhanced Dashboard Overview</h1>
                
                <!-- Feature Highlights -->
                <div class="usa-alert usa-alert--info usa-alert--slim">
                    <div class="usa-alert__body">
                        <p class="usa-alert__text">
                            <strong>✨ Enhanced Features Active:</strong> 
                            D3.js Interactive Visualizations, Advanced Complexity Analysis, Real-time Data Updates
                        </p>
                    </div>
                </div>
                
                <!-- Enhanced Stats Grid -->
                <div class="enhanced-stats-grid" id="enhancedStatsGrid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalFiles">-</div>
                        <div class="stat-label">Total Files</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalClasses">-</div>
                        <div class="stat-label">Classes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalFunctions">-</div>
                        <div class="stat-label">Functions</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="avgComplexity">-</div>
                        <div class="stat-label">Avg Complexity</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="highComplexityFiles">-</div>
                        <div class="stat-label">High Complexity</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalDomains">-</div>
                        <div class="stat-label">Domains</div>
                    </div>
                </div>
                
                <!-- Enhanced Charts Section -->
                <div class="feature-grid" style="margin-top: 30px;">
                    <div class="feature-card">
                        <h3>📊 Complexity Distribution</h3>
                        <canvas id="complexityChart" width="300" height="200"></canvas>
                    </div>
                    <div class="feature-card">
                        <h3>🏷️ Domain Distribution</h3>
                        <canvas id="domainChart" width="300" height="200"></canvas>
                    </div>
                </div>
                
                <!-- Feature Cards -->
                <div class="feature-grid">
                    <div class="feature-card">
                        <h3>🎯 Interactive Visualizations</h3>
                        <p>Explore code relationships with D3.js powered interactive diagrams. Zoom, pan, and click to navigate through your codebase structure.</p>
                        <button class="usa-button usa-button--outline interactive-button" onclick="navigationManager.showSection('relationships')">
                            Explore Relationships
                        </button>
                    </div>
                    
                    <div class="feature-card">
                        <h3>📊 Enhanced Complexity Analysis</h3>
                        <p>Advanced complexity metrics with visual indicators, trend analysis, and actionable insights for code quality improvement.</p>
                        <button class="usa-button usa-button--outline interactive-button" onclick="navigationManager.showSection('complexity')">
                            Analyze Complexity
                        </button>
                    </div>
                    
                    <div class="feature-card">
                        <h3>🔍 Smart Search & Filtering</h3>
                        <p>Intelligent search across files, classes, and functions with advanced filtering capabilities and keyboard shortcuts.</p>
                        <button class="usa-button usa-button--outline interactive-button" onclick="document.getElementById('search-input').focus()">
                            Start Searching
                        </button>
                    </div>
                </div>
                
                <!-- Quick Actions -->
                <div class="usa-card">
                    <div class="usa-card__container">
                        <div class="usa-card__header">
                            <h2 class="usa-card__heading">🚀 Quick Actions</h2>
                        </div>
                        <div class="usa-card__body">
                            <div class="usa-button-group">
                                <ul class="usa-button-group__list">
                                    <li class="usa-button-group__item">
                                        <button type="button" class="usa-button interactive-button" onclick="visualizationManager.showClassInheritanceGraph(true)">
                                            🎯 Interactive Class Map
                                        </button>
                                    </li>
                                    <li class="usa-button-group__item">
                                        <button type="button" class="usa-button usa-button--secondary interactive-button" onclick="visualizationManager.showImportDependencies(true)">
                                            🌐 Dependency Network
                                        </button>
                                    </li>
                                    <li class="usa-button-group__item">
                                        <button type="button" class="usa-button usa-button--accent-cool interactive-button" onclick="enhancedComplexityAnalyzer.init()">
                                            📊 Complexity Dashboard
                                        </button>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Files Section -->
            <div id="files" class="content-section">
                <h1 class="section-title">📁 Files Analysis</h1>
                
                <!-- Enhanced File Controls -->
                <div class="usa-button-group button-group">
                    <ul class="usa-button-group__list">
                        <li class="usa-button-group__item">
                            <button type="button" class="usa-button" onclick="dashboard.loadFiles()" data-filter-type="files" data-filter-value="all">📋 All Files</button>
                        </li>
                        <li class="usa-button-group__item">
                            <button type="button" class="usa-button usa-button--outline" onclick="dashboard.loadHighComplexityFiles()" data-filter-type="complexity" data-filter-value="high">🔥 High Complexity</button>
                        </li>
                        <li class="usa-button-group__item">
                            <button type="button" class="usa-button usa-button--outline" onclick="dashboard.applyComplexityFilter('medium')" data-filter-type="complexity" data-filter-value="medium">⚡ Medium Complexity</button>
                        </li>
                        <li class="usa-button-group__item">
                            <button type="button" class="usa-button usa-button--outline" onclick="dashboard.applyComplexityFilter('low')" data-filter-type="complexity" data-filter-value="low">✅ Low Complexity</button>
                        </li>
                        <li class="usa-button-group__item">
                            <button type="button" class="usa-button usa-button--secondary" onclick="dashboard.loadFilesByDomain()">🏷️ By Domain</button>
                        </li>
                        <li class="usa-button-group__item">
                            <button type="button" class="usa-button usa-button--accent-cool" onclick="dashboard.refreshAllData()" id="refreshData">🔄 Refresh</button>
                        </li>
                    </ul>
                </div>
                
                <div class="usa-card content-area">
                    <div class="usa-card__container">
                        <div class="usa-card__body">
                            <div id="filesList" class="list-container loading">
                                <div class="usa-spinner"></div>
                                <span class="usa-sr-only">Loading files...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Classes Section -->
            <div id="classes" class="content-section">
                <h1 class="section-title">🏗️ Classes Analysis</h1>
                
                <div class="usa-button-group button-group">
                    <ul class="usa-button-group__list">
                        <li class="usa-button-group__item">
                            <button type="button" class="usa-button" onclick="dashboard.loadClasses()" data-filter-type="class-type" data-filter-value="all">📋 All Classes</button>
                        </li>
                        <li class="usa-button-group__item">
                            <button type="button" class="usa-button usa-button--outline" onclick="dashboard.loadServiceClasses()" data-filter-type="class-type" data-filter-value="service">🔧 Services</button>
                        </li>
                        <li class="usa-button-group__item">
                            <button type="button" class="usa-button usa-button--outline" onclick="dashboard.applyClassTypeFilter('model')" data-filter-type="class-type" data-filter-value="model">📊 Models</button>
                        </li>
                        <li class="usa-button-group__item">
                            <button type="button" class="usa-button usa-button--outline" onclick="dashboard.applyClassTypeFilter('interface')" data-filter-type="class-type" data-filter-value="interface">🔌 Interfaces</button>
                        </li>
                        <li class="usa-button-group__item">
                            <button type="button" class="usa-button usa-button--secondary" onclick="visualizationManager.showClassInheritanceGraph(true)">🎯 Interactive Map</button>
                        </li>
                    </ul>
                </div>
                
                <div class="usa-card content-area">
                    <div class="usa-card__container">
                        <div class="usa-card__body">
                            <div id="classesList" class="list-container loading">
                                <div class="usa-spinner"></div>
                                <span class="usa-sr-only">Loading classes...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Functions Section -->
            <div id="functions" class="content-section">
                <h1 class="section-title">⚙️ Functions Analysis</h1>
                
                <div class="usa-button-group button-group">
                    <ul class="usa-button-group__list">
                        <li class="usa-button-group__item">
                            <button type="button" class="usa-button" onclick="dashboard.loadFunctions()" data-filter-type="function-type" data-filter-value="all">📋 All Functions</button>
                        </li>
                        <li class="usa-button-group__item">
                            <button type="button" class="usa-button usa-button--outline" onclick="dashboard.loadAsyncFunctions()" data-filter-type="function-type" data-filter-value="async">⚡ Async Functions</button>
                        </li>
                        <li class="usa-button-group__item">
                            <button type="button" class="usa-button usa-button--outline" onclick="dashboard.applyAsyncFilter(false)" data-filter-type="function-type" data-filter-value="sync">🔄 Sync Functions</button>
                        </li>
                        <li class="usa-button-group__item">
                            <button type="button" class="usa-button usa-button--outline" onclick="dashboard.applyParameterFilter('high')" data-filter-type="function-params" data-filter-value="high">📊 High Params</button>
                        </li>
                        <li class="usa-button-group__item">
                            <button type="button" class="usa-button usa-button--secondary" onclick="visualizationManager.showFunctionCallGraph()">🔗 Call Graph</button>
                        </li>
                    </ul>
                </div>
                
                <div class="usa-card content-area">
                    <div class="usa-card__container">
                        <div class="usa-card__body">
                            <div id="functionsList" class="list-container loading">
                                <div class="usa-spinner"></div>
                                <span class="usa-sr-only">Loading functions...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Services Section -->
            <div id="services" class="content-section">
                <h1 class="section-title">🔧 Services Analysis</h1>
                
                <div class="usa-button-group button-group">
                    <ul class="usa-button-group__list">
                        <li class="usa-button-group__item">
                            <button type="button" class="usa-button" onclick="dashboard.loadServices()">📋 All Services</button>
                        </li>
                        <li class="usa-button-group__item">
                            <button type="button" class="usa-button usa-button--outline" onclick="dashboard.loadServicesByDomain()">🏷️ By Domain</button>
                        </li>
                    </ul>
                </div>
                
                <div class="usa-card content-area">
                    <div class="usa-card__container">
                        <div class="usa-card__body">
                            <div id="servicesList" class="list-container loading">
                                <div class="usa-spinner"></div>
                                <span class="usa-sr-only">Loading services...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Enhanced Relationships Section -->
            <div id="relationships" class="content-section">
                <h1 class="section-title">🌐 Interactive Code Relationships</h1>
                
                <!-- Enhanced Visualization Options -->
                <details style="background: var(--dashboard-bg-secondary); padding: 15px; border-radius: 6px; margin-bottom: 20px; border: 1px solid var(--dashboard-border-light);">
                    <summary style="cursor: pointer; color: var(--dashboard-text-primary); font-weight: 600; margin-bottom: 10px;">
                        ✨ Enhanced Visualization Options (Click to expand)
                    </summary>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; font-size: 0.9em; margin-top: 15px;">
                        <div style="background: var(--dashboard-bg-card); padding: 15px; border-radius: 4px;">
                            <strong style="color: var(--dashboard-accent-primary);">📊 Static Diagrams</strong><br>
                            <small style="color: var(--dashboard-text-muted);">Quick Mermaid.js visualizations for overview</small>
                        </div>
                        <div style="background: var(--dashboard-bg-card); padding: 15px; border-radius: 4px;">
                            <strong style="color: var(--dashboard-accent-secondary);">🎯 Interactive D3.js</strong><br>
                            <small style="color: var(--dashboard-text-muted);">Zoomable, draggable networks with click interactions</small>
                        </div>
                        <div style="background: var(--dashboard-bg-card); padding: 15px; border-radius: 4px;">
                            <strong style="color: var(--dashboard-accent-tertiary);">🔍 Analysis Tools</strong><br>
                            <small style="color: var(--dashboard-text-muted);">Detailed relationship analysis and debugging</small>
                        </div>
                    </div>
                </details>

                <!-- Enhanced Relationship Controls -->
                <div class="usa-button-group button-group">
                    <ul class="usa-button-group__list">
                        <li class="usa-button-group__item">
                            <button type="button" class="usa-button" onclick="visualizationManager.showClassInheritanceGraph(false)">
                                📊 Class Inheritance
                            </button>
                        </li>
                        <li class="usa-button-group__item">
                            <button type="button" class="usa-button usa-button--secondary interactive-button" onclick="visualizationManager.showClassInheritanceGraph(true)">
                                🎯 Interactive Classes
                                <span class="enhanced-feature-badge">D3</span>
                            </button>
                        </li>
                        <li class="usa-button-group__item">
                            <button type="button" class="usa-button usa-button--outline" onclick="visualizationManager.showImportDependencies(false)">
                                📦 Import Dependencies
                            </button>
                        </li>
                        <li class="usa-button-group__item">
                            <button type="button" class="usa-button usa-button--accent-cool interactive-button" onclick="visualizationManager.showImportDependencies(true)">
                                🌐 Interactive Network
                                <span class="enhanced-feature-badge">D3</span>
                            </button>
                        </li>
                        <li class="usa-button-group__item">
                            <button type="button" class="usa-button usa-button--outline" onclick="visualizationManager.showFunctionCallGraph()">
                                ⚙️ Function Overview
                            </button>
                        </li>
                    </ul>
                </div>
                
                <!-- Enhanced Visualization Container -->
                <div class="usa-card content-area">
                    <div class="usa-card__container">
                        <div class="usa-card__body">
                            <div id="relationshipDiagram" class="d3-visualization placeholder-text">
                                <div style="text-align: center; padding: 40px;">
                                    <h3>🎯 Enhanced Relationship Visualizations</h3>
                                    <p>Select a visualization type above to explore interactive code relationships</p>
                                    <div style="margin-top: 20px; font-size: 0.9em; color: var(--dashboard-text-muted);">
                                        ✨ Try the <strong>Interactive</strong> options for D3.js powered visualizations
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Enhanced Dependencies Section -->
            <div id="dependencies" class="content-section">
                <h1 class="section-title">📦 Enhanced Dependencies Analysis</h1>
                
                <!-- Dependency Analysis Controls -->
                <div class="usa-button-group button-group">
                    <ul class="usa-button-group__list">
                        <li class="usa-button-group__item">
                            <button type="button" class="usa-button" onclick="visualizationManager.showModuleDependencies()">
                                🏢 Module Dependencies
                            </button>
                        </li>
                        <li class="usa-button-group__item">
                            <button type="button" class="usa-button usa-button--outline" onclick="visualizationManager.showExternalLibraries()">
                                📚 External Libraries
                            </button>
                        </li>
                        <li class="usa-button-group__item">
                            <button type="button" class="usa-button usa-button--secondary" onclick="visualizationManager.debugExternalLibraries()">
                                🔍 Debug Analysis
                                <span class="enhanced-feature-badge">Pro</span>
                            </button>
                        </li>
                        <li class="usa-button-group__item">
                            <button type="button" class="usa-button usa-button--accent-cool" onclick="dependencyFlowManager.showSampleFlow()">
                                🌊 Dependency Flow
                                <span class="enhanced-feature-badge">New</span>
                            </button>
                        </li>
                    </ul>
                </div>
                
                <div class="usa-card content-area">
                    <div class="usa-card__container">
                        <div class="usa-card__body">
                            <div id="dependencyList" class="placeholder-text">
                                <div style="text-align: center; padding: 40px;">
                                    <h3>📦 Dependency Analysis Tools</h3>
                                    <p>Select an analysis type above to explore your project's dependencies</p>
                                    <div style="margin-top: 20px; font-size: 0.9em; color: var(--dashboard-text-muted);">
                                        🔍 Use <strong>Debug Analysis</strong> for detailed dependency insights
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Architectural Layers Section -->
            <div id="layers" class="content-section">
                <h1 class="section-title">🏗️ Architectural Layers</h1>
                
                <!-- Layer Overview Cards -->
                <div id="layerCards" class="feature-grid">
                    <!-- Dynamically populated by architectural-layer-manager.js -->
                </div>
                
                <!-- Layer Controls -->
                <div class="usa-button-group button-group">
                    <ul class="usa-button-group__list">
                        <li class="usa-button-group__item">
                            <button type="button" class="usa-button" onclick="architecturalLayerManager.showArchitectureOverview()">📊 Architecture Overview</button>
                        </li>
                        <li class="usa-button-group__item">
                            <button type="button" class="usa-button usa-button--outline" onclick="architecturalLayerManager.showLayerDiagram()">🏗️ Layer Diagram</button>
                        </li>
                        <li class="usa-button-group__item">
                            <button type="button" class="usa-button usa-button--outline" onclick="architecturalLayerManager.showComponentMap()">🗺️ Component Map</button>
                        </li>
                    </ul>
                </div>
                
                <div class="usa-card content-area">
                    <div class="usa-card__container">
                        <div class="usa-card__body">
                            <div id="layerDetails" class="placeholder-text">
                                Click on a layer above or use the controls to view detailed analysis
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Enhanced Complexity Section -->
            <div id="complexity" class="content-section">
                <h1 class="section-title">🎯 Enhanced Complexity Analysis</h1>
                
                <!-- Complexity Legend -->
                <div class="usa-alert usa-alert--info usa-alert--slim" style="margin-bottom: 20px;">
                    <div class="usa-alert__body">
                        <div style="display: flex; align-items: center; gap: 20px; flex-wrap: wrap;">
                            <span><span class="complexity-indicator complexity-low"></span>Low (1-5)</span>
                            <span><span class="complexity-indicator complexity-medium"></span>Medium (6-10)</span>
                            <span><span class="complexity-indicator complexity-high"></span>High (11-20)</span>
                            <span><span class="complexity-indicator complexity-very-high"></span>Very High (21+)</span>
                        </div>
                    </div>
                </div>
                
                <!-- Enhanced Complexity Controls -->
                <div class="usa-button-group button-group">
                    <ul class="usa-button-group__list">
                        <li class="usa-button-group__item">
                            <button type="button" class="usa-button" onclick="complexityAnalyzer.showComplexityOverview()">📊 Overview</button>
                        </li>
                        <li class="usa-button-group__item">
                            <button type="button" class="usa-button usa-button--outline" onclick="complexityAnalyzer.showHighComplexityFiles()">🔥 High Complexity</button>
                        </li>
                        <li class="usa-button-group__item">
                            <button type="button" class="usa-button usa-button--outline" onclick="complexityAnalyzer.showComplexityTrends()">📈 Trends</button>
                        </li>
                        <li class="usa-button-group__item">
                            <button type="button" class="usa-button usa-button--secondary interactive-button" onclick="enhancedComplexityAnalyzer.init()">
                                ✨ Enhanced Analysis
                                <span class="enhanced-feature-badge">Pro</span>
                            </button>
                        </li>
                    </ul>
                </div>
                
                <!-- Enhanced Complexity Content -->
                <div class="usa-card content-area">
                    <div class="usa-card__container">
                        <div class="usa-card__body">
                            <div id="complexityContent" class="loading">
                                <div class="usa-spinner"></div>
                                <span class="usa-sr-only">Loading enhanced complexity analysis...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Domains Section -->
            <div id="domains" class="content-section">
                <h1 class="section-title">🏷️ Domain Analysis</h1>
                
                <!-- Domain Controls -->
                <div class="usa-button-group button-group">
                    <ul class="usa-button-group__list">
                        <li class="usa-button-group__item">
                            <button type="button" class="usa-button" onclick="domainAnalyzer.showDomainOverview()">📊 Overview</button>
                        </li>
                        <li class="usa-button-group__item">
                            <button type="button" class="usa-button usa-button--outline" onclick="domainAnalyzer.showDomainDetails()">🔍 Details</button>
                        </li>
                        <li class="usa-button-group__item">
                            <button type="button" class="usa-button usa-button--outline" onclick="domainAnalyzer.showCrossDomainDependencies()">🔗 Dependencies</button>
                        </li>
                    </ul>
                </div>
                
                <!-- Domain Content -->
                <div class="usa-card content-area">
                    <div class="usa-card__container">
                        <div class="usa-card__body">
                            <div id="domainContent" class="loading">
                                <div class="usa-spinner"></div>
                                <span class="usa-sr-only">Loading domain analysis...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Enhanced Help Modal -->
    <div id="helpModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; align-items: center; justify-content: center;">
        <div style="background: white; padding: 30px; border-radius: 8px; max-width: 600px; max-height: 80vh; overflow-y: auto; margin: 20px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2>🎯 Enhanced Dashboard Help</h2>
                <button onclick="closeHelpModal()" style="background: none; border: none; font-size: 1.5em; cursor: pointer;">×</button>
            </div>
            
            <!-- Enhanced Features Guide -->
            <div class="detail-section">
                <h3>✨ Enhanced Features</h3>
                <ul style="line-height: 1.8;">
                    <li><strong>D3.js Interactive Visualizations:</strong> Click the "Interactive" buttons for zoomable, draggable network diagrams</li>
                    <li><strong>Enhanced Complexity Analysis:</strong> Advanced metrics with visual indicators and trend analysis</li>
                    <li><strong>Smart Search:</strong> Intelligent search with keyboard shortcuts (Ctrl+K)</li>
                    <li><strong>Real-time Updates:</strong> Live data updates with no-cache middleware</li>
                </ul>
            </div>
            
            <!-- Navigation Tips -->
            <div class="detail-section">
                <h3>🧭 Navigation Tips</h3>
                <ul style="line-height: 1.8;">
                    <li><strong>Interactive Elements:</strong> Look for the "Enhanced" badges for new features</li>
                    <li><strong>D3.js Visualizations:</strong> Use mouse wheel to zoom, drag to pan, click nodes for details</li>
                    <li><strong>Complexity Indicators:</strong> Color-coded complexity levels throughout the interface</li>
                    <li><strong>Quick Actions:</strong> Use the overview section for rapid navigation</li>
                </ul>
            </div>
            
            <!-- Keyboard Shortcuts -->
            <div class="detail-section">
                <h3>⌨️ Keyboard Shortcuts</h3>
                <div style="background: var(--dashboard-bg-tertiary); padding: 15px; border-radius: 6px; font-family: monospace;">
                    <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 10px; align-items: center;">
                        <kbd style="background: var(--dashboard-bg-card); padding: 4px 8px; border-radius: 3px;">Ctrl + K</kbd>
                        <span>Focus search input</span>
                        <kbd style="background: var(--dashboard-bg-card); padding: 4px 8px; border-radius: 3px;">Esc</kbd>
                        <span>Close current modal</span>
                        <kbd style="background: var(--dashboard-bg-card); padding: 4px 8px; border-radius: 3px;">?</kbd>
                        <span>Show/hide this help guide</span>
                        <kbd style="background: var(--dashboard-bg-card); padding: 4px 8px; border-radius: 3px;">Ctrl + R</kbd>
                        <span>Refresh dashboard data</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced Help Button -->
    <button id="helpButton" onclick="toggleHelpModal()"
            style="position: fixed; bottom: 20px; right: 20px; background: linear-gradient(45deg, #0066cc, #00a6d6); color: white; border: none; border-radius: 50%; width: 60px; height: 60px; font-size: 1.4rem; cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.2); z-index: 1000; transition: all 0.3s ease;">
        ?
    </button>

    <!-- USWDS JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/@uswds/uswds@3.8.2/dist/js/uswds.min.js"></script>

    <!-- Load Enhanced JavaScript Components -->
    <script src="/components/reality-based-ui.js"></script>
    <script src="/components/dashboard-core.js"></script>
    <script src="/components/navigation-manager.js"></script>
    <script src="/components/data-loader.js"></script>
    <script src="/components/search-manager.js"></script>
    <script src="/components/dependency-flow-manager.js"></script>
    <script src="/components/d3-visualizer.js"></script>
    <script src="/components/modal-manager.js"></script>
    <script src="/components/visualization-manager.js"></script>
    <script src="/components/architectural-layer-manager.js"></script>
    <script src="/components/complexity-analyzer.js"></script>
    <script src="/components/enhanced-complexity-analyzer.js"></script>
    <script src="/components/domain-analyzer.js"></script>
    
    <!-- Enhanced Initialization System -->
    <script src="/components/enhanced-init.js"></script>
    
    <!-- Clean Dashboard Initialization -->
    <script>
        // Initialize Enhanced Dashboard System
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('🎯 DOM loaded, starting enhanced dashboard initialization...');
            
            try {
                // Wait for all external scripts to load
                await new Promise(resolve => {
                    if (typeof Chart !== 'undefined' && typeof d3 !== 'undefined') {
                        resolve();
                    } else {
                        let attempts = 0;
                        const checkLibraries = setInterval(() => {
                            attempts++;
                            if (typeof Chart !== 'undefined' && typeof d3 !== 'undefined') {
                                clearInterval(checkLibraries);
                                resolve();
                            } else if (attempts > 50) {
                                clearInterval(checkLibraries);
                                console.warn('⚠️ Some external libraries may not have loaded');
                                resolve();
                            }
                        }, 100);
                    }
                });
                
                // Initialize the enhanced dashboard
                if (typeof EnhancedDashboardInitializer !== 'undefined') {
                    const initializer = new EnhancedDashboardInitializer();
                    await initializer.initialize();
                    
                    // Dispatch ready event
                    window.dispatchEvent(new CustomEvent('dashboardReady', {
                        detail: { timestamp: new Date().toISOString() }
                    }));
                } else {
                    console.error('❌ EnhancedDashboardInitializer not found');
                    // Fallback initialization
                    if (typeof CodeIntelligenceDashboard !== 'undefined') {
                        window.dashboard = new CodeIntelligenceDashboard();
                        await window.dashboard.init();
                        console.log('✅ Fallback dashboard initialization complete');
                    }
                }
            } catch (error) {
                console.error('❌ Dashboard initialization failed:', error);
                // Show user-friendly error
                const errorDiv = document.createElement('div');
                errorDiv.innerHTML = `
                    <div style="position: fixed; top: 20px; left: 50%; transform: translateX(-50%); 
                                background: #dc3545; color: white; padding: 15px 25px; border-radius: 8px; 
                                z-index: 10000; box-shadow: 0 4px 12px rgba(0,0,0,0.3);">
                        <strong>⚠️ Dashboard Initialization Failed</strong><br>
                        Please refresh the page or contact support if the issue persists.
                        <button onclick="this.parentElement.parentElement.remove()" 
                                style="margin-left: 15px; background: none; border: 1px solid white; 
                                       color: white; padding: 5px 10px; border-radius: 4px; cursor: pointer;">
                            ✕
                        </button>
                    </div>
                `;
                document.body.appendChild(errorDiv);
            }
        });
    </script>
    
    <script>
        console.log('🎯 Dashboard HTML loaded, waiting for enhanced initialization...');
        
        // Listen for dashboard ready event
        window.addEventListener('dashboardReady', function(event) {
            console.log('✅ Dashboard ready event received:', event.detail);
            
            // Load initial stats
            setTimeout(async () => {
                if (window.dashboard && window.dashboard.loadStats) {
                    try {
                        await window.dashboard.loadStats();
                        console.log('📊 Initial stats loaded');
                    } catch (error) {
                        console.warn('⚠️ Failed to load initial stats:', error);
                    }
                }
            }, 500);
        });
        
        // Global error handler
        window.addEventListener('error', function(event) {
            console.error('🚨 Global error:', event.error);
        });
        
        // Test function for debugging
        window.testDashboard = function() {
            console.log('🧪 Testing dashboard components:');
            console.log('- Dashboard:', !!window.dashboard);
            console.log('- DataLoader:', !!window.dataLoader);
            console.log('- NavigationManager:', !!window.navigationManager);
            console.log('- D3.js:', typeof d3 !== 'undefined');
            console.log('- Chart.js:', typeof Chart !== 'undefined');
            console.log('- Mermaid:', typeof mermaid !== 'undefined');
            
            if (window.dashboard && window.dashboard.data) {
                console.log('- Files loaded:', window.dashboard.data.files?.length || 0);
                console.log('- Classes loaded:', window.dashboard.data.classes?.length || 0);
                console.log('- Functions loaded:', window.dashboard.data.functions?.length || 0);
            }
        };
        
        // Auto-test after 3 seconds
        setTimeout(() => {
            if (window.testDashboard) {
                window.testDashboard();
            }
        }, 3000);
        
        // Enhanced help modal functions
        window.toggleHelpModal = function() {
            const modal = document.getElementById('helpModal');
            if (modal.style.display === 'none' || !modal.style.display) {
                modal.style.display = 'flex';
                document.body.style.overflow = 'hidden';
            } else {
                modal.style.display = 'none';
                document.body.style.overflow = 'auto';
            }
        };
        
        window.closeHelpModal = function() {
            const modal = document.getElementById('helpModal');
            modal.style.display = 'none';
            document.body.style.overflow = 'auto';
        };
        
        // Enhanced keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                window.closeHelpModal();
            } else if (e.key === '?' && !e.ctrlKey && !e.altKey && !e.metaKey) {
                e.preventDefault();
                window.toggleHelpModal();
            } else if (e.ctrlKey && e.key === 'k') {
                e.preventDefault();
                document.getElementById('search-input').focus();
            } else if (e.ctrlKey && e.key === 'r') {
                e.preventDefault();
                location.reload();
            }
        });
        
        // Enhanced button hover effects
        document.addEventListener('DOMContentLoaded', function() {
            const interactiveButtons = document.querySelectorAll('.interactive-button');
            interactiveButtons.forEach(button => {
                button.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-2px)';
                    this.style.boxShadow = '0 4px 12px rgba(0,0,0,0.15)';
                });
                
                button.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0)';
                    this.style.boxShadow = '';
                });
            });
        });
    </script>
</body>
</html>